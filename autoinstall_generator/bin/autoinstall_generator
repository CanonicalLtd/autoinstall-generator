#!/usr/bin/env python3

from autoinstall_generator.merging import convert_file

import argparse
import sys


parser = argparse.ArgumentParser()
# input - d-i preseed
parser.add_argument("inpath")
# output - subiquity autoinstall
parser.add_argument('outfile', nargs='?', type=argparse.FileType('w'),
                    default=sys.stdout)
args = parser.parse_args()

if args.inpath == "-":
    infile_needs_close = False
    infile = sys.stdin
else:
    infile_needs_close = True
    infile = open(args.inpath, 'r')

try:
    out = convert_file(infile)
    args.outfile.write(out)
except:
    if infile_needs_close: infile.close()
    raise

sys.exit(0)
