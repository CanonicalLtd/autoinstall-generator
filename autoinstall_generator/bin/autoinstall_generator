#!/usr/bin/env python3

from autoinstall_generator.merging import convert_file

import argparse
import sys


parser = argparse.ArgumentParser()
# input - d-i preseed
parser.add_argument("inpath")
# output - subiquity autoinstall
parser.add_argument('outfile', nargs='?', type=argparse.FileType('w'),
                    default=sys.stdout)
args = parser.parse_args()

infile = None

try:
    if args.inpath == "-":
        infile_needs_close = False
        infile = sys.stdin
    else:
        infile_needs_close = True
        infile = open(args.inpath, 'r')

    out = convert_file(infile)
    args.outfile.write(out)
except:
    raise
finally:
    if infile_needs_close and infile:
        infile.close()

sys.exit(0)
